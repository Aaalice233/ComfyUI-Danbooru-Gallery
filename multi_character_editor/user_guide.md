# 多人角色提示词可视化编辑器 - 用户指南

## 1. 简介

多人角色提示词可视化编辑器是一个专为ComfyUI设计的高级节点，用于创建和编辑包含多个角色的复杂提示词。通过直观的可视化界面，您可以轻松管理角色、调整蒙版区域，并生成符合不同语法格式的提示词。

## 2. 主要功能

### 2.1 角色管理
- ✅ 动态添加/删除角色
- ✅ 角色属性编辑（名称、提示词、权重、颜色）
- ✅ 角色列表拖拽排序

### 2.2 蒙版编辑
- ✅ 可视化蒙版区域编辑
- ✅ 拖拽移动和调整大小
- ✅ 羽化、透明度、混合模式调整
- ✅ 网格对齐辅助
- ✅ 蒙版层级管理

### 2.3 语法支持
- ✅ Attention Couple语法
- ✅ Regional Prompts语法
- ✅ 实时语法预览
- ✅ 语法验证和错误检查

### 2.4 高级功能
- ✅ 撤销/重做操作
- ✅ 键盘快捷键支持
- ✅ 响应式布局

## 3. 界面介绍

### 3.1 整体布局
```
┌─────────────────────────────────────────────────────────┐
│                    顶部工具栏                            │
├─────────────────┬───────────────────────────────────────┤
│                 │                                       │
│   左侧角色编辑区   │         右侧蒙版编辑区                │
│                 │                                       │
│                 │                                       │
├─────────────────┴───────────────────────────────────────┤
│                    底部输出区                            │
└─────────────────────────────────────────────────────────┘
```

### 3.2 顶部工具栏
- **语法模式选择器**: 切换Attention Couple和Regional Prompts语法
- **画布尺寸设置**: 选择预设尺寸或输入自定义尺寸
- **预览开关**: 开启/关闭蒙版预览模式

### 3.3 左侧角色编辑区
- **角色列表**: 显示所有已创建的角色
- **添加角色按钮**: 创建新的角色条目
- **角色属性面板**: 编辑选中角色的详细属性
- **模板管理**: 访问和管理角色模板

### 3.4 右侧蒙版编辑区
- **Canvas画布**: 显示和编辑蒙版区域
- **蒙版控制工具**: 调整蒙版属性（羽化、透明度等）
- **网格系统**: 辅助对齐和精确定位
- **视图控制**: 缩放和平移画布

### 3.5 底部输出区
- **实时提示词显示**: 显示生成的最终提示词
- **复制按钮**: 一键复制提示词到剪贴板
- **统计信息**: 显示字符数和预估token数量
- **历史记录**: 访问之前的版本

## 4. 基础使用教程

### 4.1 创建第一个多角色提示词

#### 步骤1: 添加角色
1. 点击左侧角色编辑区的"添加角色"按钮
2. 输入角色名称，例如"女孩"
3. 在提示词输入框中输入角色描述，例如"1girl, long hair, blue eyes"
4. 调整权重滑块设置角色重要性（默认1.0）
5. 选择一个颜色标识蒙版区域

#### 步骤2: 编辑蒙版
1. 在右侧画布中，您会看到一个对应角色的彩色矩形
2. 拖拽矩形移动位置
3. 拖拽矩形角落或边缘调整大小
4. 右键点击矩形访问高级选项（羽化、透明度等）

#### 步骤3: 添加更多角色
1. 重复步骤1，添加第二个角色，例如"男孩"
2. 输入相应的提示词，例如"1boy, short hair, green eyes"
3. 在画布中调整第二个角色的蒙版位置，确保不与第一个角色重叠

#### 步骤4: 生成提示词
1. 在底部输出区查看生成的提示词
2. 根据需要调整语法模式
3. 点击复制按钮获取最终提示词

### 4.2 高级技巧

#### 蒙版精确定位
1. 开启网格对齐功能（顶部工具栏）
2. 使用右下角的网格大小滑块调整网格密度
3. 按住Shift键拖拽可以强制按比例缩放
4. 按住Ctrl键拖拽可以从中心缩放

#### 权重调整
- 权重值小于1.0会降低角色的重要性
- 权重大于1.0会增强角色的重要性
- 权重范围为0.1-2.0

#### 羽化效果
- 羽化值可以使角色边缘更加柔和
- 建议值为5-15像素
- 过高的羽化值可能导致角色边界模糊

## 5. 语法模式详解

### 5.1 Attention Couple模式
```
base_prompt COUPLE MASK(x1 x2, y1 y2) character1_prompt COUPLE MASK(x3 x4, y3 y4) character2_prompt
```

**特点**:
- 适用于需要精确控制角色位置的场景
- 支持权重和羽化参数
- 与ComfyUI的Attention Couple插件完全兼容

**示例**:
```
masterpiece, best quality COUPLE MASK(0 0.5, 0 1) 1girl, long hair, blue eyes, dress COUPLE MASK(0.5 1, 0 1) 1boy, short hair, green eyes, shirt
```

### 5.2 Regional Prompts模式
```
character1_prompt MASK(x1 x2, y1 y2) AND character2_prompt MASK(x3 x4, y3 y4)
```

**特点**:
- 适用于区域性角色分配
- 支持混合模式
- 与Regional Prompts插件完全兼容

**示例**:
```
1girl, long hair, blue eyes, dress MASK(0 0.5, 0 1) AND 1boy, short hair, green eyes, shirt MASK(0.5 1, 0 1)
```

## 6. 快捷键参考

### 6.1 通用快捷键
```
Ctrl+Z      撤销上一步操作
Ctrl+Y      重做下一步操作
Ctrl+S      保存当前配置
Delete      删除选中的角色或蒙版
Esc         取消当前操作
F1          显示帮助信息
```

### 6.2 画布操作快捷键
```
Space+拖拽   平移画布
Ctrl+滚轮    缩放画布
Shift+拖拽   等比例缩放蒙版
Ctrl+拖拽    从中心缩放蒙版
Alt+拖拽     复制蒙版
G           切换网格显示
```

### 6.3 角色编辑快捷键
```
Ctrl+N      添加新角色
Ctrl+D      复制选中角色
Ctrl+↑      上移角色
Ctrl+↓      下移角色
Enter       编辑角色名称
F2          重命名角色
```

## 7. 配置管理


### 7.3 配置文件格式
```json
{
  "version": "1.0.0",
  "syntax_mode": "attention_couple",
  "canvas": {
    "width": 1024,
    "height": 1024,
    "grid_size": 32,
    "show_grid": true
  },
  "characters": [
    {
      "id": "char_1234567890",
      "name": "女孩",
      "prompt": "1girl, long hair, blue eyes",
      "enabled": true,
      "weight": 1.0,
      "color": "#FF6B6B",
      "position": 0,
      "mask": {
        "id": "mask_1234567890",
        "x": 0.1,
        "y": 0.1,
        "width": 0.4,
        "height": 0.8,
        "feather": 5,
        "opacity": 100,
        "blend_mode": "normal",
        "zIndex": 0
      }
    }
  ]
}
```

## 8. 故障排除

### 8.1 常见问题

**Q: 为什么我的提示词没有生效？**
A: 请检查以下几点：
- 确保角色已启用（左侧开关为开启状态）
- 检查蒙版区域是否正确设置
- 验证语法模式是否与您使用的插件兼容
- 确认提示词格式是否正确

**Q: 蒙版区域显示不正确怎么办？**
A: 尝试以下解决方案：
- 刷新页面重新加载编辑器
- 检查画布尺寸设置是否正确
- 重置蒙版位置到默认值
- 清除浏览器缓存

**Q: 如何提高生成质量？**
A: 以下是一些优化建议：
- 使用更详细的角色描述
- 合理设置权重值
- 适当调整羽化参数
- 避免蒙版区域重叠

### 8.2 性能优化

**当角色数量较多时**:
- 关闭实时预览功能
- 降低网格密度
- 使用较大的画布尺寸
- 定期清理不需要的角色

**当系统响应缓慢时**:
- 减少同时编辑的角色数量
- 简化蒙版形状
- 关闭不必要的视觉效果
- 重启编辑器

## 9. 最佳实践

### 9.1 角色设计建议
- 使用具体、详细的描述
- 避免冲突的属性描述
- 合理分配角色权重
- 选择易于区分的颜色标识

### 9.2 蒙版布局技巧
- 为重要角色分配更大区域
- 避免蒙版区域过度重叠
- 利用羽化效果创建平滑过渡
- 考虑角色之间的空间关系

### 9.3 工作流程优化
- 从简单布局开始，逐步增加复杂性
- 定期保存配置以防意外丢失
- 使用模板提高工作效率
- 建立个人角色库

## 10. 进阶功能

### 10.1 自定义模板
1. 创建常用的角色配置
2. 保存为模板文件
3. 通过模板管理器快速应用

### 10.2 批量操作
- 批量调整角色权重
- 批量修改蒙版属性

### 10.3 脚本集成
- 支持通过API自动化操作
- 可以与其他ComfyUI节点联动
- 支持自定义工作流集成

## 11. 更新日志

### v1.0.0 (当前版本)
- ✅ 基础角色管理功能
- ✅ 可视化蒙版编辑
- ✅ 多语法模式支持
- ✅ 撤销/重做功能

### 计划中的功能
- 🔄 更多语法模式支持
- 🔄 AI辅助角色生成
- 🔄 高级混合模式
- 🔄 3D蒙版编辑
- 🔄 实时预览窗口

## 12. 技术支持

如果您在使用过程中遇到问题，可以通过以下方式获取帮助：

1. **查看文档**: 阅读完整的用户指南和技术文档
2. **社区支持**: 访问ComfyUI社区论坛
3. **问题反馈**: 通过GitHub提交问题报告
4. **视频教程**: 观看官方使用教程

---

**感谢您使用多人角色提示词可视化编辑器！**