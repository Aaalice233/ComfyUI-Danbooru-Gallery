# 智能补全系统测试指南

## 快速测试步骤

### 1. 基础功能测试

#### 测试英文补全
1. 在 Danbooru Gallery 节点的搜索框中输入 `bl`
2. 等待200ms后应该出现补全建议（如：black_hair, blue_eyes等）
3. 使用上下箭头键选择建议
4. 按Enter键确认选择
5. ✅ 验证：建议正确插入到输入框

#### 测试中文搜索
1. 在搜索框中输入中文：`黑色`
2. 等待200ms后应该出现中文搜索结果
3. 结果应该显示中文翻译和对应的英文标签
4. ✅ 验证：可以正确搜索并选择中文标签

#### 测试缓存功能
1. 输入 `long` 并等待建议出现
2. 删除输入，再次输入 `long`
3. 第二次应该几乎立即显示（从缓存加载）
4. ✅ 验证：缓存命中，无网络请求

### 2. 性能测试

#### 检查网络请求
1. 打开浏览器开发者工具（F12）
2. 切换到"Network"（网络）标签
3. 清空网络日志
4. 在搜索框输入几个字符
5. ✅ 验证：只有用户输入触发的请求，无预加载请求

#### 检查控制台日志
1. 打开浏览器控制台（F12 -> Console）
2. 刷新页面
3. ✅ 验证：应该看到类似以下的日志：
   ```
   [AutocompleteCache] 已加载 X 条缓存记录
   ```
4. ✅ 验证：无错误信息（红色文本）

#### 查看缓存统计
在浏览器控制台执行以下代码：

```javascript
// 方法1：在控制台查看统计
console.log('=== 智能补全缓存统计 ===');

// 注意：需要等待模块加载后才能访问
setTimeout(() => {
    // 尝试访问全局缓存实例
    const stats = window.globalAutocompleteCache?.getCacheStats();
    if (stats) {
        console.log('缓存大小:', stats.size, '/', stats.maxSize);
        console.log('命中率:', stats.hitRate);
        console.log('总请求数:', stats.requests);
        console.log('平均响应时间:', stats.avgResponseTime);
    } else {
        console.log('缓存系统尚未初始化');
    }
}, 2000);
```

预期输出示例：
```
=== 智能补全缓存统计 ===
缓存大小: 12 / 500
命中率: 85.71%
总请求数: 3
平均响应时间: 145.23ms
```

### 3. 压力测试

#### 快速输入测试
1. 快速连续输入：`b` -> `bl` -> `bla` -> `blac` -> `black`
2. ✅ 验证：系统应该流畅响应，不卡顿
3. ✅ 验证：只发送必要的网络请求（防抖生效）

#### 长时间使用测试
1. 持续使用智能补全30分钟
2. 多次输入不同的标签
3. ✅ 验证：页面不卡顿
4. ✅ 验证：内存使用正常（可在开发者工具Memory标签查看）

### 4. 边界情况测试

#### 单字符输入
1. 输入单个字符 `a`
2. ✅ 验证：不显示补全建议（最小长度为2字符）

#### 特殊字符
1. 输入 `1girl`（数字开头）
2. 输入 `_(` （下划线和括号）
3. ✅ 验证：补全正常工作

#### 网络断开
1. 在开发者工具Network标签中选择"Offline"
2. 尝试输入之前输入过的标签
3. ✅ 验证：缓存的标签仍能显示
4. ✅ 验证：新标签不显示，但无错误提示

#### API错误
1. 检查控制台是否有API错误
2. ✅ 验证：如有错误，应该有友好的错误消息
3. ✅ 验证：页面不崩溃，可以继续使用

## 性能指标

### 优化后的预期指标

| 指标 | 优化前 | 优化后 | 改善 |
|------|--------|--------|------|
| 初始化请求数 | 9个 | 0个 | -100% |
| 运行时请求数 | 1 + 3x预测 | 仅1个 | -75% |
| 缓存清理频率 | 60秒 | 300秒 | -80% |
| localStorage写入 | 高频 | 2秒节流 | -90%+ |
| 最大缓存条数 | 2000 | 500 | -75% |
| 最小查询长度 | 1字符 | 2字符 | -50%无效查询 |
| 防抖延迟 | 150ms | 200ms | 更平衡 |

### 优化后的性能表现

✅ **响应速度**
- 缓存命中: < 5ms
- 首次查询: < 500ms（网络条件正常）
- 防抖延迟: 200ms

✅ **资源占用**
- 内存占用: 约50-100KB（500条缓存）
- localStorage: 约50-100KB
- CPU占用: 极低

✅ **用户体验**
- 无明显卡顿
- 流畅的补全体验
- 快速的缓存响应

## 故障排除

### 问题1: 补全不显示

**可能原因:**
- 输入长度不足2个字符
- API服务不可用
- 浏览器控制台有JavaScript错误

**解决方法:**
1. 确保输入至少2个字符
2. 检查浏览器控制台是否有错误
3. 清理缓存并刷新页面：
```javascript
localStorage.removeItem('danbooru_autocomplete_cache_v2');
localStorage.removeItem('danbooru_autocomplete_timestamps_v2');
localStorage.removeItem('danbooru_autocomplete_frequency_v2');
location.reload();
```

### 问题2: 补全很慢

**可能原因:**
- 网络连接慢
- API服务器响应慢
- 缓存未生效

**解决方法:**
1. 检查网络连接
2. 查看Network标签的请求时间
3. 验证缓存是否工作（第二次输入应该很快）

### 问题3: 缓存不工作

**可能原因:**
- localStorage被禁用
- 缓存数据损坏

**解决方法:**
1. 检查浏览器是否允许localStorage
2. 清理缓存并重新开始
3. 查看控制台是否有缓存加载错误

### 问题4: 页面卡顿

**可能原因:**
- 其他扩展或脚本冲突
- 浏览器性能问题

**解决方法:**
1. 禁用其他浏览器扩展试试
2. 清理浏览器缓存
3. 查看控制台的性能分析（Performance标签）

## 测试清单

使用此清单确保所有功能正常：

- [ ] 英文补全正常工作
- [ ] 中文搜索正常工作
- [ ] 缓存命中率 > 70%
- [ ] 无初始化预加载请求
- [ ] 防抖功能正常（快速输入不发送过多请求）
- [ ] 键盘导航（上下键、Enter、Esc）正常
- [ ] 无控制台错误
- [ ] 页面无卡顿
- [ ] 长时间使用稳定
- [ ] 缓存清理定时器正常（5分钟一次）
- [ ] localStorage节流保存正常（2秒节流）
- [ ] 网络断开时缓存仍可用
- [ ] API错误有友好提示

## 回归测试

每次更新后都应执行以下快速回归测试：

1. **5分钟快速测试**
   - 输入2-3个英文标签
   - 输入1-2个中文词
   - 验证缓存工作
   - 检查控制台无错误

2. **完整测试（15分钟）**
   - 执行所有基础功能测试
   - 执行性能测试
   - 执行边界情况测试
   - 完成测试清单

## 报告问题

如果发现问题，请提供以下信息：

1. 浏览器类型和版本
2. 控制台错误信息（如有）
3. 网络请求截图
4. 重现步骤
5. 缓存统计信息（如可获取）

---

*测试指南版本: 1.0*
*最后更新: 2025-10-13*

